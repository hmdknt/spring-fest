# エンタープライズ・マイクロサービスの格言(妄言)

##  メモ

### はじめに
・オブジェクト指向が分からないのにマイクロサービスはできるわけがない
・マイクロサービスはなかなか実現できていない
・方法論がない
・SoRには向かない。取り組むならハイブリット

####  エンタープライズ・マイクロサービス
・エンプラ系のシステムをMSにマイグレーションしたサービス
・普通のMSとは違う


マイクロサービスは2週間でリリースするような粒度
マイクロサービスはピザ2枚程度

エンタープライズ・マイクロサービス：クジラ
マイクロサービス：てんとう虫

###  企画編
・MSの粒度は勘で決める
　・オブジェクト指向が分からなくてもJava/Spring でシステムを作ってきた実績
　・最初の粒度は、業務や機能でMSを分ける
　　・必要があれば、粒度を細かくすればよい（DDDができればなおよい）

・開発プロセスはアジャイル的である
　・要求とMサ、実装という山を相互に行き交うことで、谷間を埋めなければ、開発がうまく進まない
　・検索的な開発である

・ウォータフォールで作っているところはほとんどない

要求　MSA　実装

・スリープークス、横にしたらXP

・適応度関数には品質特性シナリオを使う
　・MSでは非機能要件が大事であるにもかかわらず、その部分が抜けて要件定義が終了するケースがある
　・品質特性シナリオを元に非機能要件をMSAに反映させ、性能テストETCで計測可能とする

・クリューバ方式でチームを編成する
　・エンタープライズなシステム開発では、技術スキルの低さが問題となるケースがある
　・優秀なチームリーダを配置（育てて配置）することで最低限の品質をチームリーダーで補償する
　・リーダーとマネージャーは優秀な人

### 開発編
・共通処理はやめる
　・処理（業務ロジックや技術要素）を共通化することで、MS個別の進化が損なわれ、コストがかかる
　　・必要があればMSとして切り出す
　・リリースが依存した場合、全てのサービスをリリースする必要がある
・テストはちゃんと作らないといけない
　・MSの進化を短時間で行うためにはテストが重要
　　・環境を整える
　　・カバレッジ率などの品質管理を実施する
　　・Spring cloud contract (api test)　
・ Unitテストは高速化する
　・@SpringBootTestを付与してUnitテストを行うと時間がかかる
　・Unitテストは@RunWith(SpringRunner.class)で行う
　　・Contoroller

　　・

　　・

・難しいことは避ける
　・エンプラ系は複雑なトランザクションを扱うことで、コレオグラフィとかSAGAパターンなどを適応することは困難
　・MS間は極力、同期通信でACID確保（トランザクションを確保できる→性能問題はインフラで頑張る）

・定説を疑え
　・レガシはデータがまとまっていない
　　・実はMS化でデータがまとまって、MS間連携が複雑化
・バッチには注意する
　・「サーブスごとにRDSも分けた、依存関係も片方向に整理した！」としても、バッチが裏から破壊するかも
　　・バッチによる
　・バッチはバッチの処理だけを行う

### まとめ
・MSのいいとこ取り→EMS















